# 围棋对战平台 - Go Battle Platform

## 项目概述

这是一个专业的围棋对弈平台**第二迭代版本**，使用 Next.js + React + TypeScript + Tailwind CSS 构建，支持完整的围棋规则、**中国围棋段位体系**、**人机对战功能**、实时目数计算、玩家管理与统计功能。

## 🎯 核心功能

### 1. 棋盘与对弈系统
- ✅ 支持 13路 (13x13, 169个交点) 和 19路 (19x19, 361个交点) 棋盘
- ✅ 完整的围棋规则实现：落子合法性校验、提子逻辑、气的计算
- ✅ 悔棋功能支持
- ✅ 天元和星位标识显示
- ✅ 响应式棋盘设计，支持移动端操作

### 2. 段位体系 ✨ NEW
- ✅ **完整的中国围棋段位系统**（30K到专业9段）
- ✅ **新玩家默认30K段位**
- ✅ **胜负记录自动影响段位变化**
- ✅ **连胜5局自动升段**，连败5局提示复盘
- ✅ **挑战限制**：只能挑战相差+2段位内的对手
- ✅ **段位进度条显示**和升段提示

### 3. 人机对战 ✨ NEW
- ✅ **AI对战模式**，棋力对应不同段位
- ✅ **AI分级从30K到专业9段**
- ✅ **人机对局计入升级体系**
- ✅ **智能AI引擎**：初学、中级、高级、专业四个级别
- ✅ **自适应难度**：根据段位选择合适的AI对手

### 4. 玩家管理系统
- ✅ 本地玩家列表展示
- ✅ 新增玩家功能（仅需输入昵称）
- ✅ **增强的玩家统计信息**：昵称、段位、胜负记录、连胜连败、段位进度
- ✅ **详细的玩家档案页面**：段位信息、进度条、统计图表
- ✅ **段位变化历史记录**

### 5. 对战模式选择 ✨ NEW
- ✅ **人人对战**：与其他玩家进行对局
- ✅ **人机对战**：与AI进行对局练习
- ✅ **AI难度选择**：从30K初学到专业9段顶级
- ✅ **智能对手推荐**：基于段位匹配合适对手
- ✅ **挑战限制提示**：段位差距过大时的友好提示

### 6. 对局管理
- ✅ 对局前玩家选择界面
- ✅ **对战模式选择**（人人对战/人机对战）
- ✅ 棋盘规格选择（13路/19路）
- ✅ 规则类型选择（吃子游戏/标准规则）
- ✅ **段位匹配验证**
- ✅ 游戏状态管理和自动保存

### 7. 实时目数计算
- ✅ 实时显示黑白双方地盘目数估算
- ✅ 区分活子、死子、空点显示
- ✅ 手动刷新目数功能
- ✅ 智能地盘分析算法

### 8. 数据存储 ✨ ENHANCED
- ✅ SQLite 数据库存储
- ✅ **扩展的Players表**：id, nickname, win_count, lose_count, total_time, **rank, consecutive_wins, consecutive_losses, total_games, last_rank_update**
- ✅ **扩展的Games表**：game_id, player1_id, player2_id, board_size, rule_type, winner_id, duration, date_time, record, **game_type, ai_difficulty, player1_rank_before, player1_rank_after, player2_rank_before, player2_rank_after**

## 🛠️ 技术栈

- **前端框架**: Next.js 15.4.0 (App Router)
- **UI 库**: React 19.1.0
- **样式**: Tailwind CSS 4.1.7
- **语言**: TypeScript 5.8.3
- **数据库**: SQLite + Drizzle ORM
- **组件库**: Radix UI + shadcn/ui
- **构建工具**: Turbopack
- **新增技术**: AI引擎、段位算法、挑战匹配系统

## 🚀 快速开始

### 环境要求
- Node.js 18.0.0 或更高版本
- npm 9.0.0 或更高版本

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd go-battle-platform
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **设置数据库**
   ```bash
   npm run db:generate
   npm run db:migrate
   npm run db:seed
   ```

4. **启动开发服务器**
   ```bash
   npm run dev
   ```

5. **访问应用**
   打开浏览器访问 `http://localhost:3000`

## 📁 项目结构

```
├── app/                    # Next.js App Router 页面
│   ├── api/               # API 路由
│   │   ├── players/       # 玩家管理 API（支持段位）
│   │   └── games/         # 游戏管理 API（支持AI对战）
│   ├── game/              # 游戏对弈页面
│   ├── players/           # 玩家管理页面（增强段位显示）
│   ├── setup/             # 游戏设置页面（新增对战模式选择）
│   └── page.tsx           # 首页
├── components/            # React 组件
│   └── ui/               # UI 组件库
│       ├── board.tsx     # 围棋棋盘组件
│       ├── game-info.tsx # 游戏信息面板
│       ├── rank-display.tsx # 段位显示组件 ✨ NEW
│       └── ...
├── lib/                   # 核心库文件
│   ├── go/               # 围棋游戏逻辑
│   │   ├── board.ts      # 棋盘逻辑
│   │   ├── game.ts       # 游戏逻辑
│   │   ├── territory.ts  # 地盘计算
│   │   ├── rank.ts       # 段位系统 ✨ NEW
│   │   ├── rank-service.ts # 段位服务 ✨ NEW
│   │   ├── ai-engine.ts  # AI引擎 ✨ NEW
│   │   └── types.ts      # 类型定义（扩展）
│   └── db/               # 数据库相关
│       ├── schema.ts     # 数据库模式（扩展）
│       ├── queries.ts    # 查询函数（增强）
│       └── drizzle.ts    # 数据库连接
└── ...
```

## 🎮 使用指南

### 1. 添加玩家
1. 访问主页，点击"玩家管理"
2. 输入玩家昵称，点击"添加"
3. **新玩家自动获得30K段位**
4. 玩家将出现在列表中，显示段位信息

### 2. 查看玩家档案 ✨ NEW
1. 在玩家列表中点击玩家昵称
2. 查看详细的段位信息和进度条
3. 查看连胜连败记录
4. 查看段位变化历史

### 3. 开始游戏
1. 点击"开始对局"进入游戏设置页面
2. **选择对战模式**：
   - **人人对战**：与其他玩家对弈
   - **人机对战**：与AI练习
3. 选择玩家（人人对战需选择两名玩家）
4. **选择AI难度**（人机对战）：从30K到专业9段
5. 选择棋盘规格（13路或19路）
6. 选择规则类型（标准规则或吃子游戏）
7. 系统会验证段位匹配（人人对战）
8. 点击"开始对局"

### 4. 进行对弈
1. 黑棋先行，点击棋盘交点落子
2. 系统自动切换到白棋回合（人机对战时AI自动落子）
3. 可以使用"弃权"、"悔棋"功能
4. 实时查看目数估算
5. 两次连续弃权结束游戏
6. **对局结束后自动更新段位**

### 5. 段位系统 ✨ NEW
- **连胜5局**：自动升一段
- **连败5局**：系统提示复盘，不自动降段
- **挑战限制**：只能挑战段位相差±2段以内的对手
- **段位进度**：实时显示升段进度条
- **人机对局**：同样计入段位升级系统

### 6. 查看统计
1. 在玩家管理页面查看总体统计
2. 点击玩家详情查看个人数据和段位信息
3. 查看历史对局记录
4. **查看段位变化历史**

## 🧪 测试

项目包含完整的围棋逻辑和段位系统测试：

```bash
# 运行基础逻辑测试
npx tsx lib/go/test-basic.ts

# 运行段位系统测试
npx tsx lib/go/test-rank-system.ts

# 运行AI引擎测试
npx tsx lib/go/test-ai-engine.ts
```

测试覆盖：
- ✅ 基础棋盘操作
- ✅ 提子逻辑验证
- ✅ 游戏流程测试
- ✅ 计分系统测试
- ✅ **段位计算测试** ✨ NEW
- ✅ **AI引擎测试** ✨ NEW
- ✅ **挑战限制测试** ✨ NEW

## 🔧 可用脚本

```bash
# 开发模式
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm start

# 数据库操作
npm run db:generate     # 生成数据库迁移
npm run db:migrate      # 执行数据库迁移
npm run db:seed         # 初始化示例数据
npm run db:studio       # 打开数据库管理界面

# 测试
npm run test            # 运行所有测试
```

## 📊 段位系统详解 ✨ NEW

### 段位结构
```
专业段位: 专业9段 → 专业8段 → ... → 专业1段
业余段位: 9段 → 8段 → ... → 1段  
业余级位: 1级 → 2级 → ... → 30级
```

### 升段规则
- **连胜5局**：自动升一段
- **连败5局**：提示复盘，不降段
- **挑战限制**：段位相差不超过±2段

### AI难度对应
- **30K-5K**: 初学级AI
- **1K-5段**: 中级AI  
- **6段-9段**: 高级AI
- **专业段位**: 专业级AI

## 🚀 第二迭代新特性总结

### ✨ 主要新增功能
1. **完整的中国围棋段位体系**
2. **人机对战功能**
3. **智能AI引擎**
4. **段位进度追踪**
5. **挑战匹配系统**
6. **增强的玩家档案**
7. **对战模式选择**

### 🔧 技术改进
1. **数据库结构扩展**
2. **API接口增强**
3. **UI/UX优化**
4. **类型系统完善**
5. **测试覆盖增强**

### 📈 系统性能
- 支持同时进行多场人机对战
- 实时段位计算和更新
- 优化的AI响应时间
- 高效的段位匹配算法

## 🎯 下一步计划（第三迭代）

- [ ] 在线多人对战支持
- [ ] 实时聊天功能
- [ ] 复盘分析工具
- [ ] 段位排行榜
- [ ] 更高级的AI算法
- [ ] 移动端原生应用

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

1. Fork 本仓库
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📝 更新日志

### v2.0.0 (当前版本)
- ✨ 新增：完整的中国围棋段位体系
- ✨ 新增：人机对战功能
- ✨ 新增：AI引擎（30K-专业9段）
- ✨ 新增：段位进度追踪和显示
- ✨ 新增：挑战限制系统
- 🔧 改进：数据库结构扩展
- 🔧 改进：API接口增强
- 🔧 改进：UI/UX优化

### v1.0.0
- ✅ 基础围棋对弈功能
- ✅ 玩家管理系统
- ✅ 实时目数计算
- ✅ 完整的围棋规则

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

---

**围棋对战平台第二迭代** - 让围棋学习更有趣，让段位提升更有成就感！ 🏆